<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Niggle.AI - Chat na Moral</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <img src="/805 Sem T√≠tulo_20250124130134.png" alt="Logo">
    <nav>
      <a href="#" id="baixarLink">Baixar .ngl</a> |
      <a href="#" id="importarLink">Importar .ngl</a> |
      <a href="#" id="newsLink">Novidades</a> |
      <a href="#" id="openConfigModal">Config.</a>
    </nav>
  </header>

  <main class="chat-container">
    <div class="message received">E a√≠, mano, **bem-vindo** ao *Niggle.AI*! Qual √© a boa? üòé</div>
    <div class="loading-animation">Niggle t√° pensando...</div>
    <div class="empty-text">Nossa, t√° mais vazio que minha conta banc√°ria!</div>
  </main>

  <footer>
    <form class="chat-input" id="chatForm">
      <input type="text" id="userMessage" placeholder="Manda o papo..." maxlength="350" required>
      <button type="submit"><img src="/send_24dp_E8EAED_FILL0_wght400_GRAD0_opsz24.png" alt="Enviar"></button>
    </form>
  </footer>

  <!-- Modal de Configura√ß√£o -->
  <div id="configModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close">√ó</span>
      <h2>Configura√ß√µes</h2>
      <div class="config-options">
        <button class="config-btn" id="installNGL">Instalar .ngl</button>
        <button class="config-btn" id="formatOfficial">Formato oficial</button>
        <button class="config-btn" id="openSavedChats">Abrir Chats Salvos</button>
        <button class="config-btn" id="baixarNGL">Baixar</button>
        <button class="config-btn" id="importNGL">Importar .ngl</button>
      </div>
    </div>
  </div>

  <!-- Modal de Novidades -->
  <div id="newsModal" class="modal">
    <div class="modal-content">
      <span id="closeNewsModal" class="close">√ó</span>
      <h2>Novidades</h2>
      <ul>
        <li>Agora tu pode continuar o papo importando teu chat .ngl, suave!</li>
        <li>Design t√° mais na r√©gua, bem adaptado pra qualquer tela.</li>
        <li>Consertamo uns bugs chatos nas configs.</li>
        <li>Agora roda liso at√© no celular mais v√©io!</li>
      </ul>
    </div>
  </div>

  <!-- Notifica√ß√£o de Doa√ß√£o -->
  <div id="donationNotification">
    <p>Gostou do rol√™? Me d√° uma for√ßa com uma doa√ß√£o, par√ßa!</p>
    <p><strong>Pix:</strong> matheusnunesdevzn@gmail.com</p>
    <button class="close-btn" onclick="closeNotification()">Fechar</button>
    <button class="donate-btn" onclick="donateNow()">Doar</button>
  </div>

  <audio id="notificationSound" src="/g.mp3" preload="auto"></audio>

  <script>
    // Lista de palavras proibidas
    const proibidas = ['xingamento1', 'xingamento2', 'palavraproibida', 'sexo', 'palavraimpropria'];
    let avisoCount = 0;

    // Fun√ß√£o pra exibir mensagens com anima√ß√£o
    function displayMessage(message, isUser) {
      const chatContainer = document.querySelector('.chat-container');
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message', isUser ? 'sent' : 'received');
      messageDiv.textContent = message;
      chatContainer.appendChild(messageDiv);
      setTimeout(() => messageDiv.classList.add('show'), 100);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      if (!isUser) playNotificationSound();
    }

    // Fun√ß√£o pra tocar som de notifica√ß√£o
    function playNotificationSound() {
      const sound = document.getElementById('notificationSound');
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(() => console.log('Erro ao tocar o som, relaxa.'));
      }
    }

    // Fun√ß√£o pra chamar a API do Cohere (ou simular resposta)
    async function getCohereResponse(message) {
      // Simula√ß√£o de resposta enquanto a API n√£o t√° 100%
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve(`Mano, tu t√° ligado que ela n√£o t√° t√£o na tua assim, n√©? üòú`);
        }, 1500);
      });
    }

    // Lida com o envio do formul√°rio
    document.getElementById('chatForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const userMessage = document.getElementById('userMessage').value.trim().toLowerCase();
      if (!userMessage) return;

      // Verifica palavras proibidas
      const contemPalavraProibida = proibidas.some(palavra => userMessage.includes(palavra));
      if (contemPalavraProibida) {
        avisoCount++;
        alert('Eita, par√ßa, sem palavra feia! üò¨ J√° √© o ' + avisoCount + '¬∫ aviso.');
        if (avisoCount >= 5) {
          alert('T√° de sacanagem? Ban de 5 dias por zoeira demais!');
          // Aqui pode adicionar l√≥gica pra banir de verdade
        }
        return;
      }

      displayMessage(userMessage, true);
      document.getElementById('userMessage').value = '';
      playNotificationSound();

      const loadingAnimation = document.querySelector('.loading-animation');
      loadingAnimation.style.display = 'block';

      const botResponse = await getCohereResponse(userMessage);
      loadingAnimation.style.display = 'none';
      displayMessage(botResponse, false);
    });

    // L√≥gica dos modais
    const openConfigModal = document.getElementById('openConfigModal');
    const configModal = document.getElementById('configModal');
    const closeModal = document.getElementById('closeModal');
    const newsLink = document.getElementById('newsLink');
    const newsModal = document.getElementById('newsModal');
    const closeNewsModal = document.getElementById('closeNewsModal');

    openConfigModal.addEventListener('click', (e) => {
      e.preventDefault();
      configModal.style.display = 'block';
    });

    closeModal.addEventListener('click', () => {
      configModal.style.display = 'none';
    });

    newsLink.addEventListener('click', (e) => {
      e.preventDefault();
      newsModal.style.display = 'block';
    });

    closeNewsModal.addEventListener('click', () => {
      newsModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === configModal) configModal.style.display = 'none';
      if (e.target === newsModal) newsModal.style.display = 'none';
    });

    // Notifica√ß√£o de doa√ß√£o ap√≥s 5 minutos
    setTimeout(() => {
      document.getElementById('donationNotification').style.display = 'block';
    }, 5 * 60 * 1000);

    function closeNotification() {
      document.getElementById('donationNotification').style.display = 'none';
    }

    function donateNow() {
      alert('Valeu pela for√ßa, par√ßa! Pix: matheusnunesdevzn@gmail.com');
      closeNotification();
    }

    // Inicializa√ß√£o
    setTimeout(() => {
      document.querySelectorAll('.message').forEach(msg => msg.style.display = 'none');
      document.querySelector('.loading-animation').style.display = 'block';
      setTimeout(() => {
        document.querySelector('.loading-animation').style.display = 'none';
        document.querySelector('.empty-text').style.display = 'block';
      }, 4000);
    }, 4000);
  </script>
</body>
</html>
